{
  "version": 3,
  "file": "Worker.js",
  "sourceRoot": "../../src/util",
  "sources": [
    "Worker.coffee"
  ],
  "names": [],
  "mappings": "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",
  "sourcesContent": [
    "\nclass Worker\n  \n  constructor:() ->\n    @logPub    = false\n    @cacheUrls = @toCacheUrls( Worker.cacheObjs )                        #    1200 = 20 min\n    @cacheOpts = { headers:{ 'Cache-Control': 'public, max-age=1200' } } # 2592000 = 30 days\n    # console.log( 'Worker.self', self )\n    @addEventListeners()\n  \n  toCacheUrls:( objs ) ->\n    urls = []\n    urls.push( obj.url ) for own key, obj of objs\n    urls\n    \n  publish:( name, status, obj=null ) =>\n    if @logPub\n      if obj?\n        console.log( name, status, obj )\n      else\n        console.log( name, status )\n    return\n  \n  onCatch:( name, status, error ) =>\n    console.log( name, status, error )\n    return\n  \n  onInstall:( event ) =>\n    event.waitUntil(\n      caches.open( Worker.cacheName )\n        .then( (cache) =>\n          @publish( 'Install', '------ Open ------' )\n          for own key, obj of Worker.cacheObjs\n            fetch( obj.url, @cacheOpts )\n              .then( (response) =>\n                @publish( '  Install', response.url )\n                return cache.put( response.url, response ) )\n          return )\n        .catch( (error) =>\n          @onCatch( 'Install', 'Error', error ); return ) )\n    return\n  \n  onInstallAll:( event ) =>\n    event.waitUntil(\n      caches.open( Worker.cacheName )\n        .then( (cache) =>\n          @publish( 'InstallAll', 'Success', { cacheName:Worker.cacheName } )\n          return cache.addAll(@cacheUrls) )\n        .catch( (error) =>\n          @onCatch( 'InstallAll', 'Error', error ); return ) )\n    return\n  \n  cacheUrlNotNeeded:( cacheUrl ) => true\n  \n  onActivate:( event ) =>\n    event.waitUntil(\n      caches.keys()\n        .then( ( @cacheUrls ) =>\n          return @cacheUrls.filter( (cacheUrl) => @cacheUrlNotNeeded(cacheUrl) ) )\n        .then( (cachesToDelete) =>\n          return Promise.all(cachesToDelete.map( (cacheToDelete) =>\n            return caches.delete(cacheToDelete) ) ) )\n        .then(() =>\n           self.clients.claim()\n           @publish( 'Activate', 'Called' ) )\n        .catch( (error) =>\n          @onCatch( 'Activate', 'Error', error )\n          return ) )\n    return\n  \n  onFetch:( event ) =>\n    console.log( 'Worker.onFetch()', event.request.url )\n    return if event.request.cache is 'only-if-cached' and event.request.mode isnt 'same-origin'\n    return if event.request.url   is 'http://localhost:3000/index.html?source=pwa'\n    event.respondWith(\n      caches.open( Worker.cacheName )\n        .then( (cache) =>\n          return cache.match( event.request, {ignoreSearch:true} ).then( (response) =>\n            return response or fetch( event.request,  @cacheOpts ).then( (response) =>\n              cache.put( event.request, response.clone() )\n              @publish( 'Fetch', event.request.url  )\n              return response ) ) )\n        .catch( (error) =>\n          @onCatch( 'Fetch', event.request.url, error  ) ) )\n    return\n  \n  onGet:( event ) =>\n    return if event.request.method isnt 'GET'\n    console.log('Worker.onGet()', event.request )\n    event.respondWith(caches.match(event.request)\n      .then((cached) =>\n        networked = fetch(event.request)\n         .then((response) =>\n           cacheCopy = response.clone()\n           caches.open(Worker.cacheName)\n            .then( (cache) =>\n               cache.put( event.request, cacheCopy )\n               @publish( 'Get', 'Success' ) )\n           return response )\n        .catch((error) =>\n           caches.match(Worker.offlinePage)\n           @onCatch( 'Get', 'Error', error  ) )\n        return cached or networked ) )\n    return\n  \n  # For now this is just an example\n  # Needs to be registered\n  onPush:( event ) =>\n    return if event.data.text() isnt Worker.pushTag\n    event.waitUntil( caches.open( Worker.cacheName ) )\n      .then( (cache) =>\n        return fetch( Worker.pushUrl ).then( (response) =>\n          cache.put(  Worker.pushUrl, response.clone() )\n          json = response.json()\n          @publish( 'Push', Worker.pushTag, { json:json } )\n          return json ) )\n    return\n   \n  # MDN says that sync may not progress to W3C standard\n  # Needs to be registered\n  onSync:( event ) =>\n    return if event.tag isnt Worker.syncTag\n    event.waitUntil( caches.open(Worker.cacheSync).then( (cache) =>\n      return cache.add(Worker.syncUrl) ) )\n    return\n  \n  addEventListeners:() -> \n    self.addEventListener('install',  @onInstall  )\n    self.addEventListener('activate', @onActivate )\n    self.addEventListener('fetch',    @onFetch    )\n    #elf.addEventListener('fetch',    @onGet      )\n    #elf.addEventListener('push',     @onPush     )\n    #elf.addEventListener('sync',     @onSync     )\n    return\n\nWorker.cacheName   = 'Axiom'\nWorker.pushTag     = 'xxx'\nWorker.pushUrl     = 'xxx'\nWorker.offlinePage = 'xxx'\nWorker.syncTag     = 'xxx'\nWorker.cacheSync   = 'xxx'\nWorker.syncUrl     = 'xxx'\nWorker.cacheObjs   = {}\n\nWorker.create = (      cacheName, cacheObjs, logPub ) ->\n  worker = new Worker( cacheName, cacheObjs, logPub )\n  if worker is false then {}\n  # console.log( \"Worker.create()\", cacheName )\n  return\n\nWorker.create( Worker.cacheName, Worker.cacheObjs, true )\n\n# export default Worker\n"
  ]
}