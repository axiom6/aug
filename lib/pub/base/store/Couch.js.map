{
  "version": 3,
  "file": "Couch.js",
  "sourceRoot": "../../../src/base/store",
  "sources": [
    "Couch.coffee"
  ],
  "names": [],
  "mappings": "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",
  "sourcesContent": [
    "\nimport Store  from './Store.js'\n\nclass Couch extends Store\n\n  constructor:( stream, dbName, baseUrl ) ->\n    super(      stream, dbName )\n    @baseUrl  = baseUrl\n    @username = 'admin'\n    @password = 'athena'\n\n  # obj: {error: \"not_found\", reason: \"missing\"}\n  add:(   table, id, obj ) ->\n    @put( table, id, obj, 'add' )\n    return\n\n  get:( table, id, callback ) ->\n    opts = { callback:callback }\n    @rest( 'get', table, id, null, opts )\n    return\n\n  put:( table, id, obj, op='put' ) ->\n    obj = @setCouchProps( table, id, obj )\n    @rest( op, table, id, obj, {} )\n    return\n\n  del:( table, id ) ->\n    where     = (obj)->true\n    selector  = @findId( table, id )\n    opts = { where:where, op2:'del' }\n    @rest( 'find', table, id, selector, opts )\n    return\n\n\n\n  select:( table,  where, callback ) ->\n    selector  = @findSelect( table )\n    opts = { where:where, callback:callback, op2:\"select\" }\n    @rest( 'find', table, 'None', selector, opts )\n    return\n\n  insert:( table, objs )  ->\n    docs = @insertDocs( table, objs )\n    opts = { objs:objs }\n    @rest( 'insert', table, 'None', { \"docs\":docs }, opts )\n    return\n\n  update:( table, objs )  ->\n    docs = @insertDocs( table, objs )\n    opts = { objs:objs }\n    @rest( 'update', table, 'None', { \"docs\":docs }, opts )\n    return\n\n  remove:( table, where ) ->\n    selector  = @findSelect( table )\n    opts = { where:where, op2:'del' }\n    @rest( 'find', table, 'None', selector, opts )\n    return\n\n  show:() ->\n    @showTables()\n    # @rest( 'show', @dbName,'None', null, {} ) # Shows all docs in db\n    return\n\n  # consider 412 status when opening an existing table\n  open:( table ) ->\n    @openTable( table )\n    @rest( 'open', table, 'None', null, {} )\n    return\n\n  # look at response obj: {ok: true}\n  drop:( table ) ->\n    @dropTable( table )\n    @rest( 'drop', table, 'None', null, {} )\n    return\n\n  queryPrac:( ) ->\n    { \"selector\":{ \"plane\": { \"$eq\":\"Know\" } } }\n\n  findSelect:( table ) ->\n    { \"selector\":{ \"table\": { \"$eq\": table.toLowerCase() } } }\n\n  findId:( table, id ) ->\n    { \"selector\":{ \"table\": { \"$eq\": table.toLowerCase() }, \"_id\": { \"$eq\": id } } }\n\n  rest:( op1, table, id, obj, opts ) ->\n    url       = @urlRest( op1, table, id )\n    json      = if obj? then JSON.stringify(obj) else null\n    settings  = @config( op1, json )\n    fetch( url, settings )\n      .then(  (response) =>\n        if not response.ok\n          @onerror( table, op1, response.statusText )\n        else\n          response.json() )\n      .then( (data) =>\n        if op1 is 'find' and opts.op2 is 'select'\n          @selectDocs( table, data, opts.where, opts.callback )\n        else if op1 is 'find'\n          @findDocs( opts.op2, table, data, opts.where, opts.callback )\n        else\n          obj1 = if obj? then obj else {}\n          objs = if opts.objs? then opts.objs else obj1\n          op   = if opts.op2 is 'del' then 'del' else op1\n          result = @restResult( op, table, objs, data, opts.where )\n          if opts.callback? then opts.callback(result) else @results( table, op, result ) )\n      .catch( (error) =>\n        @onerror( table, op1, error ) )\n    return\n\n  headers:() -> {\n    \"Content-Type\": \"application/json\"\n    \"Accept\":       \"application/json\"\n    \"Authorization\":\"Basic \" + btoa( @username + \":\" + @password ) }\n\n  config:( op, json ) ->\n    obj = {}\n    obj.method   = @restOp(op)\n    obj.body     = json if json?\n    obj.headers  = @headers()\n    obj\n\n  findDocs:( op, table, data, where, callback ) ->\n    oDocs = { \"docs\": [] }\n    dObjs = {}\n    for doc in data.docs when where(doc)\n      doc['_deleted'] = true if op is 'remove' or op is 'del'\n      doc = @setCouchProps( table, doc.id, doc, doc._rev, true )\n      oDocs.docs.push( doc )\n      dObjs[doc.id] =  doc\n    # console.log('Couch.findDocs()', { data:data, oDocs:oDocs, dObjs:dObjs } )\n    if op is 'remove'\n      opts = { where:((obj)->true), callback:callback, objs:dObjs }\n      @rest( op, table,'None', oDocs, opts )\n    else if op is 'del'\n      opts = { where:((obj)->true), callback:callback, objs:dObjs, op2:\"del\" }\n      @rest( 'remove', table,'None', oDocs, opts )\n    else if op is 'select'\n      @results( table, 'select', oDocs )\n    return\n\n  selectDocs:( table, docs, where, callback ) ->\n    results = {}\n    for doc in docs.docs when where(doc)\n      doc = @setCouchProps( table, doc.id, doc, doc._rev, true )\n      results[doc.id] = doc\n    # console.log( 'Couch.selectDocs', { table:table, docs:docs, results:results } )\n    if callback? then callback(results) else @results( table, 'select', results )\n    return\n\n  setCouchProps:( table, id, obj, rev=null, ok=null ) ->\n    obj[ 'id']    = id\n    obj['_id']    = id\n    obj['table']  = table.toLowerCase()\n    obj['_rev']   = rev if rev?\n    obj.ok        = ok  if ok?\n    obj\n\n  insertDocs:( table, objs ) ->\n    docs = []\n    for own key, obj of objs\n      obj = @setCouchProps( table, key, obj, null, null )\n      docs.push( obj )\n    docs\n\n  insertObjs:( table, objs, data ) ->\n    # console.log('Couch.insertObjs()', { objs:objs, data:data } )\n    results = {}\n    for row in data\n      id         = row.id\n      results[id] = objs[id]\n      # console.log('Couch.insertObjs()', { id:id, result:results[id], obj:objs[id] } )\n      results[id] = @setCouchProps( table, id, results[id], row.rev, row.ok )\n    results\n\n  tableObjs:( table, results, query ) ->\n    where = if query? then query else (obj)->true\n    if @isArray(results.rows)\n      objsOp = {}\n      for row in results.rows when where(row)\n        objsOp[row[@keyProp]] = row\n      objsOp\n    else\n      objsOp = {}\n      for own key, obj of results when where(row)\n        objsOp[key] = obj\n      objsOp\n\n  restResult:( op, table, obj, data, where ) ->  # obj can also be objs\n    result = {}\n    result = data                              if data? and   op is 'get'\n    result = obj                               if obj?  and ( op is 'add'    or op is 'put'    )\n    result = @insertObjs( table, obj, data )   if data? and obj?  and ( op is 'insert' or op is 'update' )\n    result = @tableObjs(  table, data, where ) if data? and ( op is 'select' )\n    result = obj                               if obj?  and ( op is 'remove' or op is 'del'  )\n    result = data                              if data? and ( op is 'show'   or op is 'drop' )\n    result\n\n  urlRest:( op, table, id ) ->\n    tableLC = table.toLowerCase()\n    switch op\n      when 'add','put'                then @baseUrl + '/' + tableLC + '?batch=ok'\n      when 'get','del'                then @baseUrl + '/' + tableLC + '/' + id\n      when 'open','drop'              then @baseUrl + '/' + tableLC\n      when 'insert','update','remove' then @baseUrl + '/' + tableLC + '/' + '_bulk_docs'\n      when 'select'                   then @baseUrl + '/' + tableLC + '/' + '_all_docs'\n      when 'find'                     then @baseUrl + '/' + tableLC + '/' + '_find'\n      when 'show'                     then @baseUrl + '/' + '_all_dbs'\n      else\n        console.error( 'Rest.urlRest() Unknown op', op, id )\n        @baseUrl + '/' + tableLC\n\n  restOp:( op ) ->\n    switch op\n      when 'open'                                        then 'PUT'\n      when 'get', 'select','show'                        then 'GET'\n      when 'insert','update','remove','find','add','put' then 'POST'\n      when 'del', 'drop'                                 then 'DELETE'\n      else\n        console.error( 'Rest.restOp() Unknown op', op )\n        'GET'\n\nexport default Couch\n\n###\n  del2:( table, id ) ->\n    # obj = {_id: \"Involve\", _rev: \"1-afa975e535c8308069eaf575eb7e01d0\", id: \"Involve\", table: \"prac\", type: \"pane\" }\n    #idRev = id + '?rev=' + \"1-afa975e535c8308069eaf575eb7e01d0\"\n    @rest( 'del', table, id, null )\n    return\n###\n"
  ]
}