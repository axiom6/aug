{
  "version": 3,
  "file": "Convey.js",
  "sourceRoot": "../../../src/muse/conn",
  "sources": [
    "Convey.coffee"
  ],
  "names": [],
  "mappings": "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",
  "sourcesContent": [
    "\nimport * as d3 from 'd3'\nimport {sankey}  from 'd3-sankey';\nimport {vis}    from '../../../lib/pub/draw/Vis.js'\n\nclass Convey\n\n  constructor:( @shapes, @defs, @g, @x, @y, @w, @h ) ->\n    @nw = 24\n    @np =  0\n    @showLabel  = false\n    Convey.Id++\n    @shapes.gradientDef( @defs, 'WhiteBlack'+Convey.Id, 'white', 'black' )\n    @gc = @g.append(\"g\")\n\n  doData:( graph ) =>\n    @sankeyc            = @createSankeyc()\n    @graph              = @sankeyc( graph )\n    [@linkSvg,@nodeSvg] = @doSankey( @sankeyc, @graph  )\n    return\n\n  createSankeyc:() ->\n    sankeyc = sankey().nodeWidth(@nw).nodePadding(@np).extent([[@x,@y],[@x+@w,@y+@h]])\n    sankeyc.link  = @sankeyLink\n    sankeyc\n\n  sankeyLink:(d) =>\n    curvature = .5\n    x0 = d.source.x1\n    x1 = d.target.x0\n    xi = d3.interpolateNumber( x0, x1 )\n    x2 = xi(curvature)\n    x3 = xi(1 - curvature)\n    y0 = d.y0\n    y1 = d.y1 + 0.1 # 0.1 prevents a pure horizontal line that did not respond to color gradients\n    'M' + x0 + ',' + y0 + 'C' + x2 + ',' + y0 + ' ' + x3 + ',' + y1 + ' ' + x1 + ',' + y1\n\n  doSankey:( sankey, graph ) ->\n    sankey.nodes(graph.nodes).links(graph.links)\n    #console.log( 'Node', node ) for node in graph.nodes\n    linkSvg = @doLinks( graph )\n    nodeSvg = @doNodes( graph )\n    [linkSvg,nodeSvg]\n\n  # .attr( \"stroke\", \"url(#WhiteBlack)\" ).attr( \"fill\",\"none\")#\n  doLinks:( graph ) ->\n    gLinks = @gc.append(\"svg:g\")\n    for d in graph.links\n      #console.log( 'Convey.doLinks() d', d )\n      id = d.source.name+d.target.name\n      @shapes.gradientDef( @defs, id, d.source.color, d.target.color )\n      gLink = gLinks.append(\"svg:g\").attr( \"stroke\", \"url(##{id})\" ).attr( \"fill\",\"none\")\n      gLink.append(\"svg:path\") #.attr(\"class\", \"link\")\n       .attr(\"d\", @sankeyc.link(d) )\n       .style(\"stroke-width\", 1 )\n       #sort( (a, b) -> (b.y1-b.y0) - (a.y1-a.y0) )\n       .append(\"title\").text( d.source.name + \" â†’ \" + d.target.name )\n    gLinks\n\n  doNodes:( graph ) ->\n    node = @gc.append(\"g\").selectAll(\".node\")\n      .data(graph.nodes).enter()\n      .append(\"g\").attr(\"class\", \"node\")\n      .attr(\"transform\", (d) -> vis.translate( d.x0,  d.y0 ) )\n    node.append(\"rect\").attr(\"height\", (d) ->  d.y1 - d.y0 )\n      .attr(\"width\", @sankeyc.nodeWidth())\n      .attr(\"fill\",   (d) => d.color )\n      .append(\"title\").text( (d) => d.name )  #  + \"\\n\" + d.value\n    if @showLabel\n      node.append(\"text\").attr(\"x\", -6).attr(\"y\", (d) -> ( d.y1 - d.y0 ) / 2 )\n        .attr(\"dy\", \".35em\").attr(\"text-anchor\", \"end\")\n        .text( (d) -> d.name )\n        .filter((d) => d['x'] < @w / 2 )\n        .attr(\"x\", 6 + @sankeyc.nodeWidth())\n        .attr( \"text-anchor\", \"start\" )\n    node\n\nConvey.Id = 0\n\nexport default Convey"
  ]
}